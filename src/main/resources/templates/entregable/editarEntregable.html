<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{layout/layout :: head}"></head>
  <body class="bg-stone-100 text-gray-900 font-[Poppins] min-h-screen">
    <header th:replace="~{layout/layout :: header}"></header>
    <!-- Banner moderno -->
    <div class="relative w-full max-w-5xl mx-auto rounded-2xl overflow-hidden shadow mb-10 mt-8">
      <img
        src="/images/bannerListar.jpg"
        alt="Banner Editar Entregable"
        class="w-full h-48 md:h-56 object-cover object-center"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-sky-500/80 to-orange-400/60 flex items-center min-h-[10rem] md:min-h-[13rem]">
        <div class="px-10">
          <h1 class="text-4xl md:text-5xl font-extrabold text-white drop-shadow-lg">
            Editar Entregable
          </h1>
          <p class="text-lg text-white/80 font-medium mt-2">
            Actualiza la informaci贸n del entregable
          </p>
        </div>
      </div>
    </div>
    <div class="max-w-5xl mx-auto px-2 md:px-0 -mt-6 md:-mt-2 relative z-10">
      <div class="bg-white rounded-2xl shadow-xl border-t-4 border-sky-400 p-4 sm:p-6 md:p-8">
        <!-- Mensajes Flash -->
        <div th:if="${success}" class="mb-4">
          <div
            class="bg-green-100 text-green-800 px-4 py-3 rounded-lg font-semibold"
            th:text="${success}"
          ></div>
        </div>
        <div th:if="${error}" class="mb-4">
          <div
            class="bg-red-100 text-red-800 px-4 py-3 rounded-lg font-semibold"
            th:text="${error}"
          ></div>
        </div>
        
        <!-- Informaci贸n del archivo actual -->
        <div class="bg-sky-50 p-4 rounded-lg mb-6 flex items-center gap-4">
          <i class="fas fa-file-alt text-3xl text-sky-500"></i>
          <div>
            <h3 class="font-bold text-sky-700">Archivo actual</h3>
            <p class="text-gray-700" th:text="${entregable.nombreArchivo}"></p>
            <div class="flex mt-2 gap-2">
              <a th:href="@{/previewEntregable/{id}(id=${entregable.id})}" target="_blank" 
                 class="inline-flex items-center text-xs px-2 py-1 bg-sky-100 text-sky-700 rounded-full hover:bg-sky-200">
                <i class="fas fa-eye mr-1"></i> Vista previa
              </a>
              <a th:href="@{/descargarEntregable/{id}(id=${entregable.id})}" 
                 class="inline-flex items-center text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full hover:bg-green-200">
                <i class="fas fa-download mr-1"></i> Descargar
              </a>
            </div>
          </div>
        </div>
        
        <form
          th:action="@{/actualizarEntregable}"
          method="post"
          enctype="multipart/form-data"
          th:object="${entregable}"
          class="space-y-6"
        >
          <!-- Campo oculto para el ID -->
          <input type="hidden" th:field="*{id}" />
          <input type="hidden" th:field="*{rutaArchivo}" />
          
          <div>
            <label
              for="nombreArchivo"
              class="block font-bold text-sky-700 mb-1"
            >
              Nombre del archivo:
            </label>
            <input
              type="text"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-sky-400 outline-none"
              id="nombreArchivo"
              th:field="*{nombreArchivo}"
              required
            />
            <div
              class="text-red-600 text-sm mt-1"
              th:if="${#fields.hasErrors('nombreArchivo')}"
              th:errors="*{nombreArchivo}"
            ></div>
          </div>
          
          <div>
            <label for="nuevoArchivo" class="block font-bold text-sky-700 mb-1">
              Reemplazar archivo (opcional):
            </label>
            <div class="flex items-center gap-4">
              <label
                for="nuevoArchivo"
                class="inline-flex items-center gap-2 bg-sky-500 hover:bg-sky-600 text-white font-semibold px-6 py-2.5 rounded-full shadow transition cursor-pointer"
              >
                <i class="fas fa-upload"></i> Seleccionar archivo
                <input
                  type="file"
                  class="hidden"
                  id="nuevoArchivo"
                  name="archivo"
                />
              </label>
              <span id="archivo-nombre" class="text-gray-700 text-sm"></span>
            </div>
            <small class="text-gray-500">Deje en blanco para mantener el archivo actual</small>
          </div>
          
          <div>
            <label for="estado" class="block font-bold text-sky-700 mb-1">
              Estado:
            </label>
            <select
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-sky-400 outline-none"
              id="estado"
              th:field="*{estado}"
              required
            >
              <option value="">Seleccionar estado</option>
              <option value="Pendiente">Pendiente</option>
              <option value="En revisi贸n">En revisi贸n</option>
              <option value="Aprobado">Aprobado</option>
              <option value="Rechazado">Rechazado</option>
            </select>
            <div
              class="text-red-600 text-sm mt-1"
              th:if="${#fields.hasErrors('estado')}"
              th:errors="*{estado}"
            ></div>
          </div>
          
          <div>
            <label for="tarea" class="block font-bold text-sky-700 mb-1">
              Tarea asociada:
            </label>
            <select
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-sky-400 outline-none"
              id="tarea"
              name="idTarea"
              required
            >
              <option value="">Seleccione una Tarea</option>
              <option
                th:each="tarea : ${tareas}"
                th:value="${tarea.id}"
                th:text="${tarea.titulo}"
                th:selected="${tarea.id == entregable.idTarea}"
              ></option>
            </select>
            <div
              class="text-red-600 text-sm mt-1"
              th:if="${#fields.hasErrors('tarea')}"
              th:errors="*{tarea}"
            ></div>
          </div>
          
          <div class="flex justify-end gap-4 pt-4">
            <a
              th:href="@{/entregable}"
              class="inline-flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-6 py-2.5 rounded-full shadow transition text-base"
            >
              <i class="fas fa-arrow-left"></i> Volver
            </a>
            <button
              type="submit"
              class="inline-flex items-center gap-2 bg-sky-500 hover:bg-sky-600 text-white font-semibold px-6 py-2.5 rounded-full shadow transition text-base"
            >
              <i class="fas fa-save"></i> Actualizar Entregable
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Mostrar nombre del archivo seleccionado
      document.getElementById("nuevoArchivo")?.addEventListener("change", function () {
        const fileName = this.files[0]?.name || "";
        const archivoNombre = document.getElementById("archivo-nombre");
        if (archivoNombre) {
          archivoNombre.textContent = fileName;
        }
      });
    </script>
  </body>
</html>