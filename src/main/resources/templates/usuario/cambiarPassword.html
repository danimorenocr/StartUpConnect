<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="layout/layout :: head">
    <title>Cambiar Contraseña</title>
</head>

<body>
    <header th:replace="layout/layout :: header"></header>

    <main class="content">

                <div class="w-64 bg-gradient-to-b from-[#043A68] to-[#52ACC4] h-screen fixed left-0 top-0"></div>

        <div class="container mx-auto px-4 py-8">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden max-w-xl mx-auto">
                <div class="p-6 bg-gradient-to-r from-[#043A68] to-[#52ACC4] text-white">
                    <h1 class="text-3xl font-bold">Cambiar Contraseña</h1>
                    <p class="text-lg opacity-80">Actualiza tu contraseña de acceso</p>
                </div>

                <div class="p-6">
                    <!-- Mensajes de éxito -->
                    <div th:if="${success != null}" class="mb-4 p-4 bg-green-100 border-l-4 border-green-500 text-green-700">
                        <p th:text="${success}">Mensaje de éxito</p>
                    </div>

                    <!-- Mensajes de error -->
                    <div th:if="${error != null}" class="mb-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700">
                        <p th:text="${error}">Mensaje de error</p>
                    </div>

                    <form th:action="@{/actualizarPassword}" method="post" id="formCambiarPassword" class="space-y-6">
                        <input type="hidden" name="documento" th:value="${usuario.documento}" />
                        
                        <div>
                            <label for="passwordActual" class="block text-sm font-medium text-gray-700 mb-1">Contraseña Actual</label>
                            <input type="password" name="passwordActual" id="passwordActual" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                        </div>
                        
                        <div>
                            <label for="passwordNueva" class="block text-sm font-medium text-gray-700 mb-1">Nueva Contraseña</label>
                            <input type="password" name="passwordNueva" id="passwordNueva" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                            <p class="text-xs text-gray-500 mt-1">La contraseña debe tener al menos 6 caracteres</p>
                            <div id="nueva-error" class="text-red-500 text-sm mt-1 hidden">
                                La nueva contraseña debe ser diferente a la actual
                            </div>
                        </div>
                        
                        <div>
                            <label for="confirmarPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Nueva Contraseña</label>
                            <input type="password" name="confirmarPassword" id="confirmarPassword" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                            <div id="confirmar-error" class="text-red-500 text-sm mt-1 hidden">
                                Las contraseñas no coinciden
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-4">
                            <a href="/perfil" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-md font-semibold hover:bg-gray-400 transition duration-200">
                                Cancelar
                            </a>
                            <button type="submit" class="px-6 py-2 bg-[#E79938] text-white rounded-md font-semibold hover:bg-[#E25D00] transition duration-200">
                                Actualizar contraseña
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>


    <script>
        // Validación de contraseñas
        const passwordActual = document.getElementById('passwordActual');
        const passwordNueva = document.getElementById('passwordNueva');
        const confirmarPassword = document.getElementById('confirmarPassword');
        const nuevaError = document.getElementById('nueva-error');
        const confirmarError = document.getElementById('confirmar-error');
        const form = document.getElementById('formCambiarPassword');

        function validatePasswords() {
            const currentPassword = passwordActual.value;
            const newPassword = passwordNueva.value;
            const confirmPassword = confirmarPassword.value;
            
            let isValid = true;

            // Limpiar errores previos
            nuevaError.classList.add('hidden');
            confirmarError.classList.add('hidden');
            passwordNueva.style.borderColor = '#d1d5db';
            confirmarPassword.style.borderColor = '#d1d5db';
            
            // Validar que la nueva contraseña no sea igual a la actual
            if (newPassword === currentPassword && newPassword !== '') {
                nuevaError.classList.remove('hidden');
                passwordNueva.style.borderColor = '#ef4444';
                isValid = false;
            }
            
            // Validar que las nuevas contraseñas coincidan
            if (confirmPassword !== '' && newPassword !== confirmPassword) {
                confirmarError.classList.remove('hidden');
                confirmarPassword.style.borderColor = '#ef4444';
                isValid = false;
            }

            return isValid;
        }

        // Validar en tiempo real mientras el usuario escribe
        passwordNueva.addEventListener('input', validatePasswords);
        confirmarPassword.addEventListener('input', validatePasswords);
        passwordActual.addEventListener('input', validatePasswords);

        // Validar antes de enviar el formulario
        form.addEventListener('submit', function(e) {
            if (!validatePasswords()) {
                e.preventDefault();
                return false;
            }
            
            // Validación adicional de longitud de contraseña
            if (passwordNueva.value.length < 6) {
                e.preventDefault();
                passwordError.textContent = 'La contraseña debe tener al menos 6 caracteres';
                passwordError.classList.remove('hidden');
                passwordNueva.style.borderColor = '#ef4444';
                return false;
            }
        });
    </script>
</body>

</html>
