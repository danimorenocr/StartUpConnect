<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="layout/layout :: head">
    <title>Cambiar Contraseña</title>
</head>

<body>
    <header th:replace="layout/layout :: header"></header>

    <main class="content">
        <div class="container mx-auto px-4 py-8">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden max-w-xl mx-auto">
                <div class="p-6 bg-gradient-to-r from-[#043A68] to-[#52ACC4] text-white">
                    <h1 class="text-3xl font-bold">Cambiar Contraseña</h1>
                    <p class="text-lg opacity-80">Actualiza tu contraseña de acceso</p>
                </div>

                <div class="p-6">
                    <form th:action="@{/actualizarPassword}" method="post" id="formCambiarPassword" class="space-y-6">
                        <input type="hidden" name="documento" th:value="${usuario.documento}" />
                        
                        <div>
                            <label for="passwordActual" class="block text-sm font-medium text-gray-700 mb-1">Contraseña Actual</label>
                            <input type="password" name="passwordActual" id="passwordActual" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                        </div>
                        
                        <div>
                            <label for="passwordNueva" class="block text-sm font-medium text-gray-700 mb-1">Nueva Contraseña</label>
                            <input type="password" name="passwordNueva" id="passwordNueva" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                            <p class="text-xs text-gray-500 mt-1">La contraseña debe tener al menos 6 caracteres</p>
                        </div>
                        
                        <div>
                            <label for="confirmarPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Nueva Contraseña</label>
                            <input type="password" name="confirmarPassword" id="confirmarPassword" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#52ACC4] focus:border-transparent"
                                required />
                            <div id="password-error" class="text-red-500 text-sm mt-1 hidden">
                                Las contraseñas no coinciden
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-4">
                            <a href="/perfil" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-md font-semibold hover:bg-gray-400 transition duration-200">
                                Cancelar
                            </a>
                            <button type="submit" class="px-6 py-2 bg-[#E79938] text-white rounded-md font-semibold hover:bg-[#E25D00] transition duration-200">
                                Actualizar contraseña
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="layout/layout :: footer"></footer>

    <script>
        // Validación de contraseñas
        const passwordNueva = document.getElementById('passwordNueva');
        const confirmarPassword = document.getElementById('confirmarPassword');
        const passwordError = document.getElementById('password-error');
        const form = document.getElementById('formCambiarPassword');

        function validatePasswords() {
            const password = passwordNueva.value;
            const confirmPassword = confirmarPassword.value;
            
            if (confirmPassword !== '') {
                if (password !== confirmPassword) {
                    passwordError.classList.remove('hidden');
                    confirmarPassword.style.borderColor = '#ef4444'; // border-red-500
                    return false;
                } else {
                    passwordError.classList.add('hidden');
                    confirmarPassword.style.borderColor = '#d1d5db'; // default border color
                    return true;
                }
            }
            return true;
        }

        // Validar en tiempo real mientras el usuario escribe
        passwordNueva.addEventListener('input', validatePasswords);
        confirmarPassword.addEventListener('input', validatePasswords);

        // Validar antes de enviar el formulario
        form.addEventListener('submit', function(e) {
            if (!validatePasswords()) {
                e.preventDefault();
                alert('Por favor, asegúrese de que las contraseñas coincidan.');
                return false;
            }
            
            // Validación adicional de longitud de contraseña
            if (passwordNueva.value.length < 6) {
                e.preventDefault();
                alert('La contraseña debe tener al menos 6 caracteres.');
                return false;
            }
        });
    </script>
</body>

</html>
