<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/layout :: head}">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-material-ui/material-ui.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-['Poppins']">
    <header th:replace="~{layout/layout :: header}"></header>
    
    <div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Banner Header -->
        <div class="relative w-full max-w-4xl mx-auto rounded-2xl overflow-hidden shadow-2xl mb-8">
            <img src="/images/bannerMentores.jpg" alt="Banner Feedback" class="w-full h-48 md:h-56 object-cover object-center">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-600/80 via-indigo-600/70 to-blue-700/60 flex items-center">
                <div class="px-8 md:px-12">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white drop-shadow-lg">
                        <i class="fas fa-comments mr-3"></i>Feedback para Startup
                    </h1>
                    <p class="text-lg text-white/90 font-medium mt-2">Proporciona retroalimentación constructiva para ayudar a la startup a mejorar</p>
                </div>
            </div>
        </div>
        
        <!-- Main Card -->
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
            <!-- Card Header -->
            <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-700 text-white p-8">
                <h2 class="text-2xl font-bold text-center flex items-center justify-center">
                    <i class="fas fa-star mr-3"></i>
                    Evaluación de Startup
                </h2>
                <p class="text-center text-white/90 mt-2">Comparte tu experiencia y califica el desempeño</p>
            </div>

            <!-- Content -->
            <div class="p-8">
                <div class="flex flex-col lg:flex-row gap-8 mb-8">
                    <!-- Startup Info Card -->
                    <div class="w-full lg:w-1/3">
                        <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-100 rounded-2xl p-6 text-center border border-blue-200 shadow-lg">
                            <div class="w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden border-4 border-white shadow-xl">
                                <img th:src="${startup.logoUrl != null ? startup.logoUrl : '/images/default-logo.png'}" 
                                    alt="Logo startup" class="w-full h-full object-cover" onerror="this.src='/images/default-logo.png'">
                            </div>
                            <h3 class="text-xl font-bold text-blue-900 mb-3" th:text="${startup.nombreStartup}">Nombre Startup</h3>
                            <div class="space-y-2">
                                <div class="flex items-center justify-center">
                                    <i class="fas fa-industry text-blue-500 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-700">Sector:</span>
                                    <span class="text-sm text-gray-600 ml-1" th:text="${startup.sector != null ? startup.sector : 'No especificado'}">Tecnología</span>
                                </div>
                                <div class="flex items-center justify-center">
                                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-700">Estado:</span>
                                    <span class="text-sm text-gray-600 ml-1" th:text="${startup.estado != null ? startup.estado : 'No especificado'}">Activo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Feedback Form -->
                    <div class="w-full lg:w-2/3">
                        <form th:action="@{/guardarFeedback}" th:object="${feedback}" method="post" id="feedbackForm" class="space-y-6">
                            <input type="hidden" th:field="*{id}" />
                            <input type="hidden" th:field="*{startup.id}" />
                            <input type="hidden" th:field="*{mentor.documento}" />
                            
                            <!-- Comentario Section -->
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-l-4 border-blue-500">
                                <label for="comentarioMentor" class="block text-blue-900 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-comment-alt mr-2"></i>
                                    Comentario del Mentor
                                </label>
                                <textarea th:field="*{comentarioMentor}" id="comentarioMentor" rows="4" 
                                          class="w-full px-4 py-3 rounded-xl border border-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80 backdrop-blur-sm"
                                          placeholder="Escribe aquí tu comentario, sugerencias o recomendaciones para la startup (mínimo 20 caracteres, máximo 200)"></textarea>
                                <p th:if="${#fields.hasErrors('comentarioMentor')}" th:errors="*{comentarioMentor}" 
                                   class="text-red-500 text-sm mt-1 flex items-center">
                                   <i class="fas fa-exclamation-triangle mr-1"></i>Error
                                </p>
                            </div>
                            
                            <!-- Rating Section -->
                            <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-6 border-l-4 border-indigo-500">
                                <label for="calificacionMentor" class="block text-indigo-900 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-star mr-2"></i>
                                    Calificación (1-5 estrellas)
                                </label>
                                <div class="rating-container flex gap-2 justify-center">
                                    <div class="flex items-center">
                                        <input type="radio" id="star1" name="calificacionMentor" value="1" th:field="*{calificacionMentor}" class="hidden" />
                                        <label for="star1" class="cursor-pointer text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200 hover:scale-110 transform">★</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" id="star2" name="calificacionMentor" value="2" th:field="*{calificacionMentor}" class="hidden" />
                                        <label for="star2" class="cursor-pointer text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200 hover:scale-110 transform">★</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" id="star3" name="calificacionMentor" value="3" th:field="*{calificacionMentor}" class="hidden" />
                                        <label for="star3" class="cursor-pointer text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200 hover:scale-110 transform">★</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" id="star4" name="calificacionMentor" value="4" th:field="*{calificacionMentor}" class="hidden" />
                                        <label for="star4" class="cursor-pointer text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200 hover:scale-110 transform">★</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" id="star5" name="calificacionMentor" value="5" th:field="*{calificacionMentor}" class="hidden" />
                                        <label for="star5" class="cursor-pointer text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200 hover:scale-110 transform">★</label>
                                    </div>
                                </div>
                                <p th:if="${#fields.hasErrors('calificacionMentor')}" th:errors="*{calificacionMentor}" 
                                   class="text-red-500 text-sm mt-1 flex items-center justify-center">
                                   <i class="fas fa-exclamation-triangle mr-1"></i>Error
                                </p>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex justify-end gap-4">
                                <a th:href="@{/misStartups}" 
                                   class="px-6 py-3 rounded-xl border-2 border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 flex items-center">
                                    <i class="fas fa-times mr-2"></i>
                                    Cancelar
                                </a>
                                <button type="button" onclick="confirmarEnvio()" 
                                        class="px-8 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 flex items-center">
                                    <i class="fas fa-paper-plane mr-2"></i>
                                    Guardar Feedback
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            
                <!-- Comentarios previos de la startup (si existen) -->
                <div th:if="${feedback.comentarioStartup != null && !feedback.comentarioStartup.isEmpty()}" 
                     class="bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-200 rounded-2xl p-6 shadow-lg">
                    <h3 class="text-xl font-bold text-amber-800 mb-4 flex items-center">
                        <i class="fas fa-comment-dots mr-2"></i>
                        Comentarios Previos de la Startup
                    </h3>
                    <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-200">
                        <p class="text-amber-700 leading-relaxed" th:text="${feedback.comentarioStartup}">Comentarios de la startup...</p>
                        <div class="mt-3 pt-3 border-t border-amber-200" th:if="${feedback.calificacionStartup != null}">
                            <div class="flex items-center justify-between">
                                <span class="text-amber-800 font-semibold flex items-center">
                                    <i class="fas fa-star-half-alt mr-2"></i>
                                    Calificación de la Startup:
                                </span>
                                <div class="flex items-center">
                                    <span class="text-2xl font-bold text-amber-600" th:text="${feedback.calificacionStartup}">5</span>
                                    <span class="text-amber-600 ml-1">/5</span>
                                    <div class="ml-2 flex">
                                        <span th:each="i : ${#numbers.sequence(1, feedback.calificacionStartup ?: 0)}" class="text-yellow-400">★</span>
                                        <span th:each="i : ${#numbers.sequence((feedback.calificacionStartup ?: 0) + 1, 5)}" class="text-gray-300">★</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Función para validar el formulario
        function validarFormulario() {
            const comentario = document.getElementById('comentarioMentor').value.trim();
            const calificacion = document.querySelector('input[name="calificacionMentor"]:checked');
            
            if (comentario.length < 20 || comentario.length > 200) {
                Swal.fire({
                    title: 'Error de validación',
                    text: 'El comentario debe tener entre 20 y 200 caracteres',
                    icon: 'error',
                    confirmButtonColor: '#3b82f6',
                    confirmButtonText: 'Entendido'
                });
                return false;
            }
            
            if (!calificacion) {
                Swal.fire({
                    title: 'Error de validación',
                    text: 'Por favor, selecciona una calificación',
                    icon: 'error',
                    confirmButtonColor: '#3b82f6',
                    confirmButtonText: 'Entendido'
                });
                return false;
            }
            
            return true;
        }
        
        // Función para confirmar el envío
        function confirmarEnvio() {
            if (!validarFormulario()) return;
            
            Swal.fire({
                title: '¿Confirmar envío del feedback?',
                text: 'Una vez enviado, este feedback será visible para la startup',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '<i class="fas fa-paper-plane mr-2"></i>Sí, enviar',
                cancelButtonText: '<i class="fas fa-times mr-2"></i>Cancelar',
                customClass: {
                    popup: 'rounded-2xl',
                    confirmButton: 'rounded-xl',
                    cancelButton: 'rounded-xl'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Mostrar loading
                    Swal.fire({
                        title: 'Enviando feedback...',
                        text: 'Por favor espera un momento',
                        icon: 'info',
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        customClass: {
                            popup: 'rounded-2xl'
                        }
                    });
                    document.getElementById('feedbackForm').submit();
                }
            });
        }
        
        // Función mejorada para las estrellas con animaciones
        document.addEventListener('DOMContentLoaded', function() {
            const stars = document.querySelectorAll('input[name="calificacionMentor"]');
            const labels = document.querySelectorAll('label[for^="star"]');
            
            // Inicializar estrellas según valor actual
            const currentRating = document.querySelector('input[name="calificacionMentor"]:checked');
            if (currentRating) {
                const value = parseInt(currentRating.value);
                updateStars(value);
            }
            
            // Función para actualizar las estrellas
            function updateStars(rating) {
                labels.forEach((label, index) => {
                    if (index < rating) {
                        label.classList.remove('text-gray-300');
                        label.classList.add('text-yellow-400');
                        label.style.transform = 'scale(1.1)';
                    } else {
                        label.classList.remove('text-yellow-400');
                        label.classList.add('text-gray-300');
                        label.style.transform = 'scale(1)';
                    }
                });
            }
            
            // Manejar eventos de las estrellas
            stars.forEach((star, index) => {
                const label = labels[index];
                
                // Hover effect
                label.addEventListener('mouseenter', function() {
                    const value = parseInt(star.value);
                    labels.forEach((l, i) => {
                        if (i < value) {
                            l.classList.remove('text-gray-300');
                            l.classList.add('text-yellow-400');
                            l.style.transform = 'scale(1.2)';
                        } else {
                            l.classList.remove('text-yellow-400');
                            l.classList.add('text-gray-300');
                            l.style.transform = 'scale(1)';
                        }
                    });
                });
                
                // Mouse leave - restore to selected state
                label.addEventListener('mouseleave', function() {
                    const selectedStar = document.querySelector('input[name="calificacionMentor"]:checked');
                    if (selectedStar) {
                        updateStars(parseInt(selectedStar.value));
                    } else {
                        labels.forEach(l => {
                            l.classList.remove('text-yellow-400');
                            l.classList.add('text-gray-300');
                            l.style.transform = 'scale(1)';
                        });
                    }
                });
                
                // Click/change event
                star.addEventListener('change', function() {
                    const value = parseInt(this.value);
                    updateStars(value);
                    
                    // Feedback visual al seleccionar
                    labels.forEach((l, i) => {
                        if (i < value) {
                            l.style.animation = 'bounce 0.6s ease';
                            setTimeout(() => {
                                l.style.animation = '';
                            }, 600);
                        }
                    });
                });
            });
            
            // Agregar animación CSS para el bounce
            const style = document.createElement('style');
            style.textContent = `
                @keyframes bounce {
                    0%, 20%, 60%, 100% { transform: translateY(0) scale(1.1); }
                    40% { transform: translateY(-10px) scale(1.2); }
                    80% { transform: translateY(-5px) scale(1.15); }
                }
            `;
            document.head.appendChild(style);
        });
    </script>

</body>

</html>
