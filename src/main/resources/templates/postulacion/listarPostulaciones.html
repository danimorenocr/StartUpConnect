<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/layout :: head}"></head>
<link rel="stylesheet" th:href="@{/css/postulacion/listarPostulaciones.css}">
<style>
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
    }
    
    .alert-success {
        background-color: rgba(76, 175, 80, 0.1);
        border: 1px solid rgba(76, 175, 80, 0.5);
        color: #2e7d32;
    }
    
    .alert-danger {
        background-color: rgba(244, 67, 54, 0.1);
        border: 1px solid rgba(244, 67, 54, 0.5);
        color: #d32f2f;
    }
      .alert i {
        margin-right: 10px;
        font-size: 18px;
    }
    
    /* Estilos para botones de administración */
    .btn-action.admin {
        background-color: #9c27b0;
        color: white;
    }
    
    .btn-action.admin:hover {
        background-color: #7b1fa2;
        transform: translateY(-2px);
    }
    
    .btn-action.approve {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-action.approve:hover {
        background-color: #45a049;
        transform: translateY(-2px);
    }
    
    .btn-action.reject {
        background-color: #f44336;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-action.reject:hover {
        background-color: #da190b;
        transform: translateY(-2px);
    }
    
    .btn-action.review {
        background-color: #ff9800;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }    .btn-action.review:hover {
        background-color: #f57c00;
        transform: translateY(-2px);
    }
    
    /* Estilos para banner de administrador */
    .admin-info-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .admin-badge {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 16px;
    }
    
    .admin-badge i {
        margin-right: 8px;
        font-size: 18px;
    }
    
    .admin-description {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
        line-height: 1.4;
    }
    
    /* Mejoras generales del diseño */
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.1;
    }
    
    .banner-content {
        position: relative;
        z-index: 1;
    }
    
    .main-title {
        font-size: 3rem;
        font-weight: bold;
        margin: 0 0 10px 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .banner-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin: 0;
    }
    
    .btn-crear {
        position: absolute;
        right: 40px;
        top: 50%;
        transform: translateY(-50%);
        text-decoration: none;
    }
    
    .btn-crear button {
        background: white;
        color: #667eea;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .btn-crear button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        background: #f8f9ff;
    }
    
    .search-container {
        position: relative;
        margin-bottom: 30px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .search-input {
        width: 100%;
        padding: 15px 50px 15px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
    }
    
    .search-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
        font-size: 18px;
    }
    
    .postulaciones-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .postulacion-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        overflow: hidden;
        transition: all 0.3s ease;
        border: 1px solid rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
    }
    
    .postulacion-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    
    .card-header {
        position: relative;
        height: 200px;
        overflow: hidden;
    }
    
    .img-container {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    
    .project-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .postulacion-card:hover .project-img {
        transform: scale(1.05);
    }
    
    .status-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .status-approved {
        background: #4caf50;
        color: white;
    }
    
    .status-rejected {
        background: #f44336;
        color: white;
    }
    
    .status-review {
        background: #ff9800;
        color: white;
    }
    
    .status-pending {
        background: #2196f3;
        color: white;
    }
    
    .card-body {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .project-name {
        font-size: 1.4rem;
        font-weight: 700;
        color: #333;
        margin: 0 0 15px 0;
        line-height: 1.3;
    }
    
    .project-info {
        flex-grow: 1;
        margin-bottom: 20px;
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding: 8px 0;
        border-bottom: 1px solid #f5f5f5;
    }
    
    .info-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .info-label {
        font-weight: 600;
        color: #666;
        font-size: 14px;
    }
    
    .info-value {
        color: #333;
        font-size: 14px;
        text-align: right;
        max-width: 200px;
        word-wrap: break-word;
    }
    
    .card-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .btn-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }
    
    .btn-action.view {
        background-color: #2196f3;
        color: white;
    }
    
    .btn-action.view:hover {
        background-color: #1976d2;
        transform: translateY(-2px);
    }
    
    .btn-action.edit {
        background-color: #ff9800;
        color: white;
    }
    
    .btn-action.edit:hover {
        background-color: #f57c00;
        transform: translateY(-2px);
    }
    
    .btn-action.delete {
        background-color: #f44336;
        color: white;
    }
    
    .btn-action.delete:hover {
        background-color: #d32f2f;
        transform: translateY(-2px);
    }
    
    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .no-results i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }
    
    .no-results p {
        font-size: 1.2rem;
        margin: 0;
    }
    
    .hidden {
        display: none !important;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
        .main-title {
            font-size: 2rem;
        }
        
        .btn-crear {
            position: static;
            transform: none;
            margin-top: 20px;
        }
        
        .postulaciones-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .container {
            padding: 15px;
        }
        
        .banner {
            padding: 30px 15px;
        }
        
        .card-actions {
            justify-content: center;
        }
    }
    
    /* Estilos para banner de administrador */
    .admin-info-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .admin-badge {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 16px;
    }
    
    .admin-badge i {
        margin-right: 8px;
        font-size: 18px;
    }
    
    .admin-description {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
        line-height: 1.4;
    }
</style>
<body>

    <header th:replace="~{layout/layout :: header}"></header>
      <div class="banner">
        <div class="banner-content">
            <h1 class="main-title">Postulaciones</h1>
            <p class="banner-subtitle">Revisa y gestiona las postulaciones de proyectos</p>
        </div>
        <a th:href="@{/crearPostulacion}" class="btn-crear">
            <button type="button">Crear Postulación</button>
        </a>
    </div>    <div class="container">
        <!-- Información adicional para administradores -->
        <div th:if="${isAdmin}" class="admin-info-banner">
            <div class="admin-badge">
                <i class="fas fa-user-shield"></i>
                <span>Modo Administrador</span>
            </div>
            <p class="admin-description">Como administrador, puedes gestionar el estado de todas las postulaciones directamente desde esta vista o acceder a la gestión detallada.</p>
        </div>
        
        <!-- Mensajes de éxito y error -->
        <div class="alert alert-success" th:if="${mensajeExito}" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${mensajeExito}"></span>
        </div>
        
        <div class="alert alert-danger" th:if="${error}" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
        </div>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar postulación por nombre, estado o etapa..." class="search-input">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <div class="postulaciones-grid">
            <div th:each="postulacion: ${postulaciones}" class="postulacion-card" 
                 th:data-nombre="${postulacion.nombreProyecto}"
                 th:data-estado="${postulacion.estado}"
                 th:data-etapa="${postulacion.etapaProyecto}">
                
                <div class="card-header">
                    <div class="img-container">
                        <img th:src="${postulacion.fotoUrl != null ? postulacion.fotoUrl : '/images/sinfoto.jpg'}" 
                             alt="Imagen del proyecto" class="project-img">
                    </div>
                    <div class="status-badge" th:classappend="${
                        postulacion.estado == 'Aprobada' ? 'status-approved' : 
                        postulacion.estado == 'Rechazada' ? 'status-rejected' : 
                        postulacion.estado == 'En revisión' ? 'status-review' : 'status-pending'
                    }" th:text="${postulacion.estado}">
                    </div>
                </div>
                
                <div class="card-body">
                    <h3 class="project-name" th:text="${postulacion.nombreProyecto}"></h3>
                    
                    <div class="project-info">
                        <div class="info-row">
                            <span class="info-label">Startup:</span>
                            <span class="info-value" th:text="${postulacion.startup != null ? postulacion.startup.nombreStartup : 'No asignada'}"></span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Etapa:</span>
                            <span class="info-value" th:text="${postulacion.etapaProyecto}"></span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Fecha:</span>
                            <span class="info-value" th:text="${#dates.format(postulacion.fechaPostulacion, 'dd/MM/yyyy')}"></span>
                        </div>
                    </div>
                      <div class="card-actions">
                        <!-- Botones estándar para todos los usuarios -->
                        <a th:href="@{/verPostulacion/{id}(id=${postulacion.id})}" class="btn-action view">
                            <i class="fas fa-eye"></i>
                        </a>
                        
                        <!-- Botones de edición y eliminación solo para usuarios no admin o para sus propias postulaciones -->
                        <th:block th:if="${!isAdmin}">
                            <a th:href="@{/editarPostulacion/{id}(id=${postulacion.id})}" class="btn-action edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a th:href="@{/eliminarPostulacion/{id}(id=${postulacion.id})}" class="btn-action delete"
                               onclick="return confirm('¿Estás seguro de que deseas eliminar esta postulación?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </th:block>
                        
                        <!-- Botones de administración solo para administradores -->
                        <th:block th:if="${isAdmin}">
                            <a th:href="@{/gestionarPostulacion/{id}(id=${postulacion.id})}" class="btn-action admin"
                               title="Gestionar postulación">
                                <i class="fas fa-cogs"></i>
                            </a>
                            
                            <!-- Botones de cambio de estado rápido -->
                            <th:block th:if="${postulacion.estado != 'Aprobada'}">
                                <form th:action="@{/cambiarEstadoPostulacion/{id}(id=${postulacion.id})}" method="post" style="display: inline;">
                                    <input type="hidden" name="nuevoEstado" value="Aprobada">
                                    <button type="submit" class="btn-action approve" title="Aprobar"
                                            onclick="return confirm('¿Confirmas que deseas aprobar esta postulación?')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </form>
                            </th:block>
                            
                            <th:block th:if="${postulacion.estado != 'Rechazada'}">
                                <form th:action="@{/cambiarEstadoPostulacion/{id}(id=${postulacion.id})}" method="post" style="display: inline;">
                                    <input type="hidden" name="nuevoEstado" value="Rechazada">
                                    <button type="submit" class="btn-action reject" title="Rechazar"
                                            onclick="return confirm('¿Confirmas que deseas rechazar esta postulación?')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </form>
                            </th:block>
                            
                            <th:block th:if="${postulacion.estado != 'En revisión'}">
                                <form th:action="@{/cambiarEstadoPostulacion/{id}(id=${postulacion.id})}" method="post" style="display: inline;">
                                    <input type="hidden" name="nuevoEstado" value="En revisión">
                                    <button type="submit" class="btn-action review" title="Poner en revisión"
                                            onclick="return confirm('¿Confirmas que deseas poner esta postulación en revisión?')">
                                        <i class="fas fa-clock"></i>
                                    </button>
                                </form>
                            </th:block>
                        </th:block>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="no-results" class="no-results hidden">
            <i class="fas fa-search"></i>
            <p>No se encontraron postulaciones que coincidan con tu búsqueda</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const postulacionCards = document.querySelectorAll('.postulacion-card');
            const noResults = document.getElementById('no-results');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                let hasVisibleCards = false;
                
                postulacionCards.forEach(card => {
                    const nombre = card.getAttribute('data-nombre').toLowerCase();
                    const estado = card.getAttribute('data-estado').toLowerCase();
                    const etapa = card.getAttribute('data-etapa').toLowerCase();
                    
                    if (nombre.includes(searchTerm) || estado.includes(searchTerm) || etapa.includes(searchTerm)) {
                        card.style.display = 'flex';
                        hasVisibleCards = true;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                if (hasVisibleCards) {
                    noResults.classList.add('hidden');
                } else {
                    noResults.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
